<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gigas - Gás & Água</title>

    <!-- PWA -->
    <meta name="theme-color" content="#0d6efd"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="favicon-192.png">
    
    <!-- Fonte -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Estilos CSS -->
    <style>
        :root {
            --primary-color: #0d6efd;
            --primary-dark: #0a58ca;
            --light-bg: #f8f9fa;
            --text-color: #212529;
            --text-muted: #6c757d;
            --white: #fff;
            --gray: #dee2e6;
            --success: #198754;
            --danger: #dc3545;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --border-radius: 16px;
            --sidebar-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--light-bg); color: var(--text-color); overflow-x: hidden; }

        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-color); display: flex; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity 0.5s ease-out;
        }
        #splash h1 { color: var(--white); font-size: 48px; font-weight: 800; }

        .main-wrapper { display: flex; }

        /* Sidebar Menu */
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 8000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out; }
        #sidebar-overlay.visible { opacity: 1; visibility: visible; }
        #sidebar {
            width: var(--sidebar-width); height: 100vh;
            background: var(--white); z-index: 8001;
            display: flex; flex-direction: column;
            border-right: 1px solid var(--gray);
            position: fixed; top: 0; left: 0;
            transform: translateX(-100%); transition: transform 0.3s ease-in-out;
        }
        .sidebar-header { background: var(--primary-color); color: var(--white); padding: 20px; }
        .sidebar-header h2 { font-size: 1.5em; }
        .sidebar-nav { list-style: none; padding: 10px 0; flex-grow: 1; overflow-y: auto; }
        .sidebar-nav li a { display: flex; align-items: center; padding: 15px 20px; color: var(--text-color); text-decoration: none; font-weight: 600; border-left: 4px solid transparent; }
        .sidebar-nav li a:hover { background: var(--light-bg); }
        .sidebar-nav li a.active { background: #e7f1ff; color: var(--primary-color); border-left-color: var(--primary-color); }
        .sidebar-nav li a svg { width: 22px; height: 22px; margin-right: 15px; color: var(--text-muted); }
        .sidebar-nav li a.active svg { color: var(--primary-color); }
        .sidebar-nav li a.logout { color: var(--danger); }

        /* Main Content */
        .app-container { width: 100%; transition: margin-left 0.3s ease-in-out; }
        .header { background: var(--primary-color); color: var(--white); padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .header-main { flex-grow: 1; }
        .header h1 { font-size: 1.5em; }
        .header-menu-btn { background: none; border: none; padding: 8px; cursor: pointer; }
        .header-menu-btn svg { color: var(--white); width: 28px; height: 28px; }
        
        .container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--white); padding: 25px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 20px; }
        .container h2 { font-size: 1.8em; font-weight: 800; margin-bottom: 20px; }

        /* Auth Screen */
        #authScreen { display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .auth-card { text-align: center; max-width: 400px; width: 100%; }
        .auth-card img { width: 100px; margin-bottom: 20px; }
        .auth-card h2 { font-size: 24px; }
        .auth-card p { margin-bottom: 20px; }

        /* Form Styles */
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .form-group input { width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--gray); font-size: 16px; }
        button { width: 100%; padding: 16px; margin-top: 10px; border-radius: 12px; border: none; cursor: pointer; background: var(--primary-color); color: var(--white); font-weight: 700; font-size: 16px; transition: background-color 0.3s; }
        button.btn-secondary { background: var(--white); color: var(--primary-color); border: 1px solid var(--primary-color); }
        
        /* Product Styles */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { /* Estilos mantidos */ }

        /* Responsive Design */
        @media (max-width: 992px) {
            #sidebar.open { transform: translateX(0); }
        }
        @media (min-width: 992px) {
            #sidebar { transform: translateX(0); }
            .app-container { margin-left: var(--sidebar-width); }
            .header-menu-btn { display: none; }
        }

        /* Toast Notification */
        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: var(--text-color); color: white; padding: 15px 25px; border-radius: 50px; z-index: 10000; transition: bottom 0.5s ease-in-out; }
        #toast.show { bottom: 30px; }
        #toast.success { background: var(--success); }
        #toast.error { background: var(--danger); }
    </style>
</head>
<body>

    <div id="splash"><h1>Gigas</h1></div>

    <div class="main-wrapper">
        <!-- SIDEBAR MENU -->
        <div id="sidebar-overlay"></div>
        <nav id="sidebar">
            <div class="sidebar-header"><h2>Gigas App</h2></div>
            <ul class="sidebar-nav">
                <li><a href="#" class="sidebar-link active" data-screen="homeScreen"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg> Início</a></li>
                <li><a href="#" class="sidebar-link" data-screen="profileScreen"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg> Perfil</a></li>
                <li><a href="#" class="sidebar-link" data-screen="addressScreen"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" /></svg> Endereço</a></li>
                <li><a href="#" class="sidebar-link" data-screen="pedidosScreen"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3" /></svg> Histórico de Pedidos</a></li>
                <li><a href="#" class="sidebar-link" data-screen="couponsScreen"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.59,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.77,14.05 22,13.55 22,13C22,12.45 21.77,11.95 21.41,11.58M13,20L4,11V4H11L20,13M6.5,5A1.5,1.5 0 1,1 5,6.5A1.5,1.5 0 0,1 6.5,5Z" /></svg> Meus Cupons</a></li>
                <li><a href="#" class="sidebar-link" data-screen="walletScreen"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4M20,18H4V6H20V18M15,12H13V10H11V12H9V14H11V16H13V14H15V12Z" /></svg> Minha Carteira</a></li>
                <li><a href="#" id="logoutBtn" class="sidebar-link logout"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z" /></svg> Sair</a></li>
            </ul>
        </nav>

        <!-- APP CONTAINER -->
        <main class="app-container">
            <!-- TELA DE LOGIN / CADASTRO -->
            <div id="authScreen" class="screen">
                <div class="auth-card">
                    <img src="https://i.imgur.com/g82unHh.png" alt="Botijão de Gás">
                    <h2 id="authTitle"></h2>
                    <p id="authSubtitle"></p>
                    <div id="authFormContainer"></div>
                    <div id="authToggle"></div>
                </div>
            </div>

            <!-- TELA PRINCIPAL (HOME) -->
            <div id="homeScreen" class="screen">
                <div class="header">
                    <div class="header-main"><h1>Olá, <span id="homeUserName"></span>!</h1></div>
                    <button class="header-menu-btn" id="openSidebarBtn"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg></button>
                </div>
                <div class="container">
                    <h2>Nossos Produtos</h2>
                    <div id="productList" class="product-grid"></div>
                </div>
            </div>

            <!-- TELA DE PERFIL -->
            <div id="profileScreen" class="screen">
                <div class="header"><div class="header-main"><h1>Meu Perfil</h1></div></div>
                <div class="container"><div class="card"><form id="profileForm"><div class="form-group"><label for="profileName">Nome Completo</label><input type="text" id="profileName" required></div><div class="form-group"><label for="profilePhone">Telefone</label><input type="tel" id="profilePhone" placeholder="(XX) XXXXX-XXXX"></div><button type="submit">Salvar Alterações</button></form></div></div>
            </div>

            <!-- TELA DE ENDEREÇO -->
            <div id="addressScreen" class="screen">
                <div class="header"><div class="header-main"><h1>Meu Endereço</h1></div></div>
                <div class="container"><div class="card"><form id="addressForm"><div class="form-group"><label for="addressStreet">Rua</label><input type="text" id="addressStreet"></div><div class="form-group"><label for="addressNumber">Número</label><input type="text" id="addressNumber"></div><div class="form-group"><label for="addressNeighborhood">Bairro</label><input type="text" id="addressNeighborhood"></div><div class="form-group"><label for="addressCity">Cidade</label><input type="text" id="addressCity"></div><button type="submit">Salvar Endereço</button></form></div></div>
            </div>

            <!-- TELA DE CUPONS -->
            <div id="couponsScreen" class="screen">
                <div class="header"><div class="header-main"><h1>Meus Cupons</h1></div></div>
                <div class="container" id="couponsList"></div>
            </div>

            <!-- TELA DE CARTEIRA -->
            <div id="walletScreen" class="screen">
                <div class="header"><div class="header-main"><h1>Minha Carteira</h1></div></div>
                <div class="container"><div class="card"><h3>Cartões Salvos</h3><div id="walletList"></div><button class="btn-secondary" style="margin-top: 20px;">Adicionar Novo Cartão</button></div></div>
            </div>
            
            <!-- TELA DE PEDIDOS -->
            <div id="pedidosScreen" class="screen">
                <div class="header"><div class="header-main"><h1>Meus Pedidos</h1></div></div>
                <div class="container"><div id="historicoPedidos"></div></div>
            </div>
        </main>
    </div>
    <div id="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4h0J54TZqT8XXUsPSL3_ABVJQ05yP4Hc",
            authDomain: "giovanigas-d959b.firebaseapp.com",
            projectId: "giovanigas-d959b",
            storageBucket: "giovanigas-d959b.appspot.com",
            messagingSenderId: "728326355548",
            appId: "1:728326355548:web:9dda06e1c1148337618499",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        
        let currentUserData = null;

        const showToast = (message, type = 'success') => { /* ... (código mantido) ... */ };
        const showScreen = (screenId) => { /* ... (código mantido) ... */ };
        const openSidebar = () => { /* ... (código mantido) ... */ };
        const closeSidebar = () => { /* ... (código mantido) ... */ };

        const renderProfileScreen = () => { /* ... (código mantido) ... */ };
        const renderAddressScreen = () => { /* ... (código mantido) ... */ };
        const renderCouponsScreen = () => { /* ... (código mantido) ... */ };
        const renderWalletScreen = () => { /* ... (código mantido) ... */ };
        const renderProducts = () => { /* ... (código mantido) ... */ };
        
        const renderAuthForm = (isLogin) => {
            if (isLogin) {
                $('#authTitle').textContent = "Bem-vindo de volta!";
                $('#authSubtitle').textContent = "Faça login para continuar.";
                $('#authFormContainer').innerHTML = `<form id="loginForm"><div class="form-group"><label for="loginEmail">E-mail</label><input type="email" id="loginEmail" required></div><div class="form-group"><label for="loginSenha">Senha</label><input type="password" id="loginSenha" required></div><button type="submit">Entrar</button></form>`;
                $('#authToggle').innerHTML = `<button id="toggleToCadastro" class="btn-secondary">Criar nova conta</button>`;
                $('#loginForm').addEventListener('submit', handleLogin);
                $('#toggleToCadastro').addEventListener('click', () => renderAuthForm(false));
            } else {
                $('#authTitle').textContent = "Crie sua conta";
                $('#authSubtitle').textContent = "É rápido e fácil!";
                $('#authFormContainer').innerHTML = `<form id="cadastroForm"><div class="form-group"><label for="cadNome">Nome</label><input type="text" id="cadNome" required></div><div class="form-group"><label for="cadEmail">E-mail</label><input type="email" id="cadEmail" required></div><div class="form-group"><label for="cadSenha">Senha</label><input type="password" id="cadSenha" required minlength="6"></div><button type="submit">Cadastrar</button></form>`;
                $('#authToggle').innerHTML = `<button id="toggleToLogin" class="btn-secondary">Já tenho conta</button>`;
                $('#cadastroForm').addEventListener('submit', handleCadastro);
                $('#toggleToLogin').addEventListener('click', () => renderAuthForm(true));
            }
        };

        const handleCadastro = async (e) => {
            e.preventDefault();
            const { cadNome, cadEmail, cadSenha } = e.target.elements;
            try {
                const cred = await createUserWithEmailAndPassword(auth, cadEmail.value, cadSenha.value);
                await setDoc(doc(db, "clientes", cred.user.uid), { nome: cadNome.value, email: cadEmail.value });
            } catch (error) { showToast('Erro no cadastro: ' + error.message, 'error'); }
        };

        const handleLogin = async (e) => {
            e.preventDefault();
            const { loginEmail, loginSenha } = e.target.elements;
            try {
                await signInWithEmailAndPassword(auth, loginEmail.value, loginSenha.value);
            } catch (error) { showToast('E-mail ou senha inválidos.', 'error'); }
        };

        const handleProfileUpdate = async (e) => { /* ... (código mantido) ... */ };
        const handleAddressUpdate = async (e) => { /* ... (código mantido) ... */ };

        onAuthStateChanged(auth, async (user) => {
            const appContainer = $('.app-container');
            const mainWrapper = $('.main-wrapper');

            if (user) {
                const userDocRef = doc(db, "clientes", user.uid);
                const userDoc = await getDoc(userDocRef);
                if (userDoc.exists()) {
                    currentUserData = userDoc.data();
                    $('#homeUserName').textContent = currentUserData.nome.split(' ')[0];
                } else {
                    const nome = user.email.split('@')[0] || "Usuário";
                    await setDoc(userDocRef, { nome, email: user.email });
                    currentUserData = { nome, email: user.email };
                    $('#homeUserName').textContent = nome;
                }
                mainWrapper.style.display = 'flex';
                appContainer.style.display = 'block';
                showScreen('homeScreen');
            } else {
                currentUserData = null;
                mainWrapper.style.display = 'block'; // Para centralizar a tela de auth
                appContainer.style.display = 'block';
                renderAuthForm(true);
                showScreen('authScreen');
            }
        });

        window.onload = () => {
            setTimeout(() => {
                $('#splash').style.opacity = '0';
                setTimeout(() => { $('#splash').style.display = 'none'; }, 500);
            }, 1000);

            renderProducts();
            $('#openSidebarBtn').addEventListener('click', openSidebar);
            $('#sidebar-overlay').addEventListener('click', closeSidebar);
            $('#logoutBtn').addEventListener('click', () => signOut(auth));

            $$('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const screenId = e.currentTarget.dataset.screen;
                    showScreen(screenId);
                    if(screenId === 'profileScreen') renderProfileScreen();
                    if(screenId === 'addressScreen') renderAddressScreen();
                    if(screenId === 'couponsScreen') renderCouponsScreen();
                    if(screenId === 'walletScreen') renderWalletScreen();
                });
            });

            $('#profileForm').addEventListener('submit', handleProfileUpdate);
            $('#addressForm').addEventListener('submit', handleAddressUpdate);
            
            document.body.addEventListener('click', (e) => {
                if(e.target.classList.contains('copy-coupon-btn')) {
                    const code = e.target.dataset.code;
                    navigator.clipboard.writeText(code).then(() => {
                        showToast(`Código "${code}" copiado!`);
                    });
                }
            });
        };
    </script>
</body>
</html>
